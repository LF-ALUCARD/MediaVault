package devfull.MediaVault.service;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import devfull.MediaVault.entities.User;
import devfull.MediaVault.entities.DTO.AuthResponseDTO;
import devfull.MediaVault.entities.DTO.UserInfoDTO;
import devfull.MediaVault.entities.DTO.UserRegisterDTO;
import devfull.MediaVault.entities.enums.UserRole;
import devfull.MediaVault.repositories.UserRepository;
import devfull.MediaVault.secury.GerarToken;

@Service
public class UserService {

    @Autowired
    private UserRepository repositor;

    @Autowired
    private GerarToken gerarToken;

    public AuthResponseDTO register(UserRegisterDTO obj) {
        User entidade = converter(obj);
        User savedUser = repositor.save(entidade);
        String token = gerarToken.gerarToken(savedUser);
        UserInfoDTO userInfo = new UserInfoDTO(savedUser);
        return new AuthResponseDTO(token, userInfo);
    }

    private static User converter(UserRegisterDTO obj) {
        User entidade = new User();
        entidade.setNome(obj.getNome());
        entidade.setEmail(obj.getEmail());
        entidade.setRole(UserRole.valueOfCode(obj.getRole()));
        entidade.setSenha(obj.getSenha());
        return entidade;
    }
}